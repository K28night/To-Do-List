<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To Do List</title>
    <link rel="stylesheet" href="../css/index.css">
    <!-- <link rel="stylesheet" href="./add_task.css"> -->
    <link rel="stylesheet" href="../css/login.css">
</head>
<body>
    <header>
        <div class="logo">
            <h2>To-Do List</h2>
        </div>
        <div class="links">
            <a href="index.html">Home</a> 
            <a href="about.html">About</a>
            <a href="./register.html" title="You already in that page">Register</a></div>
            <!-- <button class="login" onclick="window.location.href='login.html'" id="login">Login</button> -->
    </header>
    <div class="form-heading">
    </div>
        <div class="form">
            
            <form action="login.html" method="GET">
                <h2>Login</h2>
                <p id="login">if you are not registered then <a href="./register.html">Register</a></p>
                <small id="message"></small>
                <input type="text" name="username" placeholder="UserName" id="username" required>
                <input type="password" id="password" name="pass" title="password" placeholder="Password"required><br>
                <input type="submit" name="submit" id="submit" value="Submit">
            </form>
        </div>
</body>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$('#submit').click(function(event) {
    event.preventDefault();

    var email = $('#username').val();
    var pass = $('#password').val();

    // Retrieve stored user data from localStorage
    var storedUser = localStorage.getItem("users");

    if (storedUser) {
        var users = JSON.parse(storedUser); // Parse array of users

        // Check if any user matches the credentials
       var foundUser = null;

for (var i = 0; i < users.length; i++) {
    if (users[i].email == email && users[i].password == pass) {
        foundUser = users[i];
        break; // stop loop once found
    }
}

        if (foundUser) {
            $("#login").text("Login successful! " + foundUser.email).css("color", "green");

            var sessionUser = {
                name: foundUser.name,
                email: foundUser.email
            };
            sessionStorage.setItem("user", JSON.stringify(sessionUser));

            // Optional delay before redirecting
            setTimeout(function () {
                window.location.href = './welcome.html';
            }, 1000); // 1 second delay
        } else {
            $("#login").text("Invalid email or password."+storedUser).css("color", "red");
        }
    } else {
        $("#login").text("No user found. Please register first.").css("color", "red");
    }
});

</script>
</html>